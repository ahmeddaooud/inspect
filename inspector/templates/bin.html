{% extends "layout.html" %}
{% block title %}PAYFORT Inspector - {{bin.name}}{% endblock %}
{% block icon %}<link rel="shortcut icon" href="{{bin.favicon_uri}}" />{% endblock %}

{% block sidebar %}{% endblock %}
{% block binurl %}
<!--<form action="/" method="POST">-->
  <!--<div align="center">-->
<!--<p class="button">-->
                <!--<a class="btn btn-small btn-danger" name="deleteButton" id="deleteButton" onclick="deleteBinNew()" ><i class="icon-remove-sign" ></i> Delete {{bin.name}} inspector </a>-->
              <!--</p>-->
<!--&lt;!&ndash;<a href="/delete_bin" id="delete">Delete inspector</a>&ndash;&gt;-->
<!--</div>-->
<!--</form>-->
  <a class="btn btn-success" href="/{{bin.name}}?inspect"><i class="icon-refresh icon-x"></i> Refresh</a>
  <!--<a href="/{{bin.name}}?inspect"><i class="icon-repeat icon-2x" style="color: rgb{{bin.color}}"></i></a>-->
  <input type="text" value="{{base_url}}/{{bin.name}}" onclick="this.select()" />
  {% if bin.private %}<i class="icon-lock"></i>{% endif %}
  <a class="btn btn-danger" href="/" onclick="if (confirm('Are you sure you want to delete this inspector?')){deleteBinNew()}else{event.stopPropagation(); event.preventDefault();};"><i class="icon-remove-sign"></i> Delete</a>
{% endblock %}

{% block head %}
    <script type="text/javascript">
      function deleteBinNew() {
        $.ajax({'url': '/api/v1/deletebin', 'type': 'POST',
          'data': {'name': $('#deleteButton').attr("id")},
          'success': function(data) {
           window.location.href = "/";
          }
        });
      }
    </script>
{% endblock %}

{% block content %}
    {% for request in bin.requests %}
      <div class="message-wrapper" id="message-wrapper-{{request.id}}">
        <div class="message-list">
          <div class="row-fluid">
            <div class="span4">
              {{base_url}}<br>
              <span class="method">{{request.method}}</span> 
              <span class="absolute-path">{{request.path}}</span><span class="querystring">{{request.query_string|to_qs}}</span>
            </div>
            <div class="span6 content">
              {% if request.content_type %}<i class="icon-code"></i>{% endif %} {{request.content_type}}<br>
              <i class="icon-cloud-upload"></i> {{request.content_length|friendly_size}}
            </div>
            <div class="span2" class="timestamp">
              <span title="{{request.time|exact_time}}">{{request.time|approximate_time}} ago
                <a href="#{{request.id}}"><i class="icon-time"></i></a>
              </span><br>
              From {{request.remote_addr}}
            </div>
          </div>
        </div>

        <div id="detail-{{request.id}}" class="message-detail">
            {{ message_detail(request) }}
        </div>
      </div>
    {% else %}

      <h4 class="text-center">Inspector URL</h4>
      <h2 class="text-center">
        <input class="xxlarge input-xxlarge" type="text" value="{{base_url}}/{{bin.name}}" onclick="this.select()" style="border-color: rgb{{bin.color}}; border-width: 3px;" /></h2>
      <p class="text-center">{% if bin.private %}This is a private bin. Requests are only viewable from this computer.{% endif %}

      <hr>
      <div class="row-fluid">
        <div class="span6 offset3">


    {% endfor %}

      <hr>

      <div class="alert-message block-message info">
        <h4>Limits</h4>
        <p>This {% if bin.private %}<strong>private</strong>{% endif %}
        inspector will keep the last 50 requests made to it and remain available for 48 hours after it was created.
        However, data might be cleared at any time, so <strong>treat inspector as highly ephemeral</strong>.</p>
        <!--<h4>Need more?</h4>-->
        <!--<p><a href="https://www.payfort.com">Visit PAYFORT</a>.</p>-->
      </div>
{% endblock %}


{% macro message_detail(request) %}
<div id="request-detail-{{request.id}}" class="request-detail">
    <div class="row-fluid">
      <div class="span4">
        <h5>FORM/POST PARAMETERS</h5>
        {% for k,v in request.form_data %}
          <p class="keypair"><strong>{{k}}:</strong> {{v}}</p>
        {% else %}
          <em>None</em>
        {% endfor %}

        {% if request.query_string and not request.query_string is string %}
          <h5>QUERYSTRING</h5>
          {% for k,v in request.query_string|dictsort: %}
            {% if not v %}
              <p class="keypair"><strong>{{k}}</strong></p>
            {% else %}
              <p class="keypair"><strong>{{k}}:</strong> {{v}}</p>
            {% endif %}
          {% endfor %} 
        {% endif %}
      </div>
      <div class="span6">
        {% if request.headers %}
          <h5>PRIMARY HEADERS</h5>
            {% for header in request.headers.items() %}
              <p class="keypair"><strong>{{header.0}}:</strong> {{header.1|escape}}</p>
            {% endfor %}
        {% endif %}
      </div>
    </div>

    <h5>RAW BODY</h5>
    <div class="request-body" data-id="{{ request.id }}">
<pre class="body prettyprint">{%if request.raw%}{{request.raw}}{%else%}<em>None</em>{%endif%}</pre>

  </div>
</div>
{% endmacro %}
